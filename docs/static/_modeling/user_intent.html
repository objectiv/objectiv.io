<div>
                
  <section id="basic-user-intent-analysis">
<span id="example-user-intent"/><h1>Basic user intent analysis<a class="headerlink" href="#basic-user-intent-analysis" title="Permalink to this headline">#</a></h1>
<p>This example shows how the open model hub can be used for basic user intent analysis.</p>
<p>This example is also available in a <a class="reference external" href="https://github.com/objectiv/objectiv-analytics/blob/main/notebooks/basic-user-intent.ipynb">notebook</a>
to run on your own data or use our
<a class="reference external" href="https://objectiv.io/docs/home/quickstart-guide/">quickstart</a> to try it out with demo data in 5 minutes.</p>
<p>At first we have to install the open model hub and instantiate the Objectiv DataFrame object. See
<a class="reference internal" href="example_notebooks.html#get-started-with-objectiv"><span class="std std-ref">Getting started with Objectiv</span></a> for more info on this. The data used in this example is
based on the data set that comes with our quickstart docker demo.</p>
<p>Besides the open model hub, we have to import the following packages for this example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span/><span class="kn">from</span> <span class="nn">bach</span> <span class="kn">import</span> <span class="n">display_sql_as_markdown</span>
<span class="kn">import</span> <span class="nn">bach</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>
</pre></div>
</div>
<p>The columns &#8216;global_contexts&#8217; and the &#8216;location_stack&#8217; contain most of the event specific data. These columns
are json type columns and we can extract data from it based on the keys of the json objects using
<a class="reference internal" href="modelhub_api_reference/modelhub.SeriesLocationStack.objectiv.html#get-from-context-with-type-series"><span class="std std-ref">get_from_context_with_type_series</span></a>. Or use methods
specific to the <a class="reference internal" href="open_taxonomy.html#location-stack"><span class="std std-ref">location_stack</span></a> or <a class="reference internal" href="open_taxonomy.html#global-contexts"><span class="std std-ref">global_contexts</span></a> to
extract the data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span/><span class="n">df</span><span class="p">[</span><span class="s1">'application'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">global_contexts</span><span class="o">.</span><span class="n">gc</span><span class="o">.</span><span class="n">application</span>
<span class="n">df</span><span class="p">[</span><span class="s1">'root_location'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">location_stack</span><span class="o">.</span><span class="n">ls</span><span class="o">.</span><span class="n">get_from_context_with_type_series</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">'RootLocationContext'</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">'id'</span><span class="p">)</span>
</pre></div>
</div>
<section id="exploring-root-location">
<h2>Exploring root location<a class="headerlink" href="#exploring-root-location" title="Permalink to this headline">#</a></h2>
<p>The root_location context in the location_stack uniquely represents the top-level UI location of the user. As a first step of grasping user intent, this is a good starting point to see in what main areas of your product users are spending time.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span/><span class="n">modelhub</span><span class="o">.</span><span class="n">aggregate</span><span class="o">.</span><span class="n">unique_users</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s1">'application'</span><span class="p">,</span> <span class="s1">'root_location'</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="exploring-session-duration">
<h2>Exploring session duration<a class="headerlink" href="#exploring-session-duration" title="Permalink to this headline">#</a></h2>
<p>The average <cite>session_duration</cite> model from the <a class="reference internal" href="intro.html#modelhub-intro"><span class="std std-ref">open model hub</span></a> is another good pointer to explore first for user intent.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span/><span class="n">modelhub</span><span class="o">.</span><span class="n">aggregate</span><span class="o">.</span><span class="n">session_duration</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s1">'application'</span><span class="p">,</span> <span class="s1">'root_location'</span><span class="p">])</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<p>Now, we can look at the distribution of time spent. We used the Bach quantile operation for this. We&#8217;ll use this distribution to define the different stages of user intent.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span/><span class="c1"># how is this time spent distributed?</span>
<span class="n">session_duration</span> <span class="o">=</span> <span class="n">modelhub</span><span class="o">.</span><span class="n">aggregate</span><span class="o">.</span><span class="n">session_duration</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">groupby</span><span class="o">=</span><span class="s1">'session_id'</span><span class="p">)</span>

<span class="c1"># materialization is needed because the expression of the created series contains aggregated data, and it is not allowed to aggregate that.</span>
<span class="n">session_duration</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">materialize</span><span class="p">()[</span><span class="s1">'session_duration'</span><span class="p">]</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">q</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="defining-different-stages-of-user-intent">
<h2>Defining different stages of user intent<a class="headerlink" href="#defining-different-stages-of-user-intent" title="Permalink to this headline">#</a></h2>
<p>After exploring the <cite>root_location</cite> and <cite>session_duration</cite> (both per root location and quantiles), we can make a simple definition of different stages of user intent.</p>
<p>Based on the objectiv.io website data in the quickstart:</p>
<p>We think that users that spent most time (90th percentile) and specifically in our documentation sections are in the Implement phase of Objectiv. If you look at the other quantiles, it feels sensible to deem that users beyond the 50th up to 90th perctile in our documentation sections are Exploring. The remaining users are Informing themselves about the product. Those users are spending less than two minutes in the docs and/or spend any amount of time on our main website.</p>
<table class="colwidths-given table">
<colgroup>
<col style="width: 20%"/>
<col style="width: 50%"/>
<col style="width: 30%"/>
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>User intent</p></th>
<th class="head"><p>Root locations</p></th>
<th class="head"><p>Duration</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>1 - Inform</p></td>
<td><p><em>all sections other than the ones mentioned below</em></p></td>
<td><p><em>any time spent</em></p></td>
</tr>
<tr class="row-odd"><td><p>1 - Inform</p></td>
<td><p>Docs: modeling, taxonomy, tracking, home</p></td>
<td><p>less than 2 minutes</p></td>
</tr>
<tr class="row-even"><td><p>2 - Explore</p></td>
<td><p>Docs: modeling, taxonomy, tracking, home</p></td>
<td><p>between 2 and 19 minutes</p></td>
</tr>
<tr class="row-odd"><td><p>3 - Implement</p></td>
<td><p>Docs: modeling, taxonomy, tracking, home</p></td>
<td><p>more than 19 minutes</p></td>
</tr>
</tbody>
</table>
<p>This is just for illustration purposes, you can adjust these definitions based on your own collected data.</p>
</section>
<section id="assigning-user-intent">
<h2>Assigning user intent<a class="headerlink" href="#assigning-user-intent" title="Permalink to this headline">#</a></h2>
<p>Based on the definitions above, we can start assigning a stage of intent to each user.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span/><span class="c1"># set the root locations that we will use based on the definitions above</span>
<span class="n">roots</span> <span class="o">=</span> <span class="n">bach</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_pandas</span><span class="p">(</span><span class="n">engine</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">engine</span><span class="p">,</span>
                                   <span class="n">df</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'roots'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'modeling'</span><span class="p">,</span> <span class="s1">'taxonomy'</span><span class="p">,</span> <span class="s1">'tracking'</span><span class="p">,</span> <span class="s1">'home'</span><span class="p">,</span> <span class="s1">'docs'</span><span class="p">]}),</span>
                                   <span class="n">convert_objects</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">roots</span>

<span class="c1"># now we calculate the total time spent per _user_ and create a data frame from it</span>
<span class="n">user_intent_buckets</span> <span class="o">=</span> <span class="n">modelhub</span><span class="o">.</span><span class="n">agg</span><span class="o">.</span><span class="n">session_duration</span><span class="p">(</span><span class="n">df</span><span class="p">,</span>
                                                    <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s1">'user_id'</span><span class="p">],</span>
                                                    <span class="n">method</span><span class="o">=</span><span class="s1">'sum'</span><span class="p">,</span>
                                                    <span class="n">exclude_bounces</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>

<span class="c1"># same as above, but for selected roots only</span>
<span class="n">explore_inform_users_session_duration</span> <span class="o">=</span> <span class="n">modelhub</span><span class="o">.</span><span class="n">agg</span><span class="o">.</span><span class="n">session_duration</span><span class="p">((</span><span class="n">df</span><span class="p">[(</span><span class="n">df</span><span class="o">.</span><span class="n">root_location</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">roots</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">application</span><span class="o">==</span><span class="s1">'objectiv-docs'</span><span class="p">)]),</span>
                                                                      <span class="n">groupby</span><span class="o">=</span><span class="s1">'user_id'</span><span class="p">,</span>
                                                                      <span class="n">method</span><span class="o">=</span><span class="s1">'sum'</span><span class="p">)</span>
<span class="c1"># and set it as column</span>
<span class="n">user_intent_buckets</span><span class="p">[</span><span class="s1">'explore_inform_duration'</span><span class="p">]</span> <span class="o">=</span> <span class="n">explore_inform_users_session_duration</span>

<span class="c1"># first, we set the Inform bucket as a catch-all, meaning users that do not fall into Explore and Implement will be defined as Inform</span>
<span class="n">user_intent_buckets</span><span class="p">[</span><span class="s1">'bucket'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'1 - inform'</span>

<span class="c1"># calculate buckets duration</span>
<span class="n">user_intent_buckets</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">user_intent_buckets</span><span class="o">.</span><span class="n">explore_inform_duration</span> <span class="o">&gt;=</span> <span class="n">timedelta</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">120</span><span class="p">))</span> <span class="o">&amp;</span>
                        <span class="p">(</span><span class="n">user_intent_buckets</span><span class="o">.</span><span class="n">explore_inform_duration</span> <span class="o">&lt;=</span> <span class="n">timedelta</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1140</span><span class="p">)),</span> <span class="s1">'bucket'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'2 - explore'</span>
<span class="n">user_intent_buckets</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">user_intent_buckets</span><span class="o">.</span><span class="n">explore_inform_duration</span> <span class="o">&gt;</span> <span class="n">timedelta</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1140</span><span class="p">),</span> <span class="s1">'bucket'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'3 - implement'</span>
</pre></div>
</div>
<p>Now, we have assigned intent to each user and can for example look at the total number of users per intent bucket.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span/><span class="c1"># total number of users per intent bucket</span>
<span class="n">user_intent_buckets</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">'bucket'</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s1">'user_id'</span><span class="p">:</span> <span class="s1">'nunique'</span><span class="p">})</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="what-s-next">
<h2>What&#8217;s next?<a class="headerlink" href="#what-s-next" title="Permalink to this headline">#</a></h2>
<p>The are many next possible analysis steps, for example:</p>
<ul class="simple">
<li><p>What product features do each of the intent groups use?</p></li>
<li><p>What kind of intent users come from different marketing campaigns?</p></li>
<li><p>How can we drive more users to the &#8216;Implement&#8217; stage? Look at different product features that users with the &#8216;Implement&#8217; intent use, compared to &#8216;Explore&#8217;.</p></li>
</ul>
<p>A good starting point for these analyses on top of the user intent buckets is the basic product analytics example in the <a class="reference internal" href="example_notebooks.html#example-notebooks"><span class="std std-ref">example notebooks</span></a>.</p>
</section>
<section id="get-the-sql-for-this-user-intent-analysis">
<h2>Get the SQL for this user intent analysis<a class="headerlink" href="#get-the-sql-for-this-user-intent-analysis" title="Permalink to this headline">#</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span/><span class="c1"># get the SQL to use this analysis in for example your BI tooling</span>
<span class="n">display_sql_as_markdown</span><span class="p">(</span><span class="n">user_intent_buckets</span><span class="p">)</span>
</pre></div>
</div>
</section>
</section>


              </div>
              
              
              