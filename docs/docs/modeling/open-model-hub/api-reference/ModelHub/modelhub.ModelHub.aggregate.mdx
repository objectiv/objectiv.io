---
id: open-model-hub-api-reference-model-hub-modelhub-model-hub-aggregate
slug: /modeling/open-model-hub/api-reference/ModelHub/aggregate/
title: aggregate
---

# modelhub.ModelHub.aggregate

<div className="property">

### <span className="type-annotation"><em>property </em></span> <span className="name">aggregate</span>




<div className="content">

Access aggregation methods from the model hub. Same as [`agg`](/modeling/open-model-hub/api-reference/ModelHub/modelhub.ModelHub.agg.mdx).

<div className="class">

## <span className="type-annotation"><em>class</em></span> <span className="name">Aggregate</span>

<small className="parameter-list">(<span className="parameter" id="mh">mh</span>)</small>


<div className="content">

Models that return aggregated data in some form from the original DataFrame with Objectiv data.

<div className="method">

### <span className="name">frequency</span>

<small className="parameter-list">(<span className="parameter" id="data">data</span>)</small>


<div className="content">

Calculate a frequency table for the number of users by number of sessions.


#### Parameters

**`data`** – [`bach.DataFrame`](/modeling/bach/api-reference/DataFrame/bach.DataFrame.mdx) to apply the method on.



#### Returns

series with results.



</div>


</div>

<div className="method">

### <span className="name">retention_matrix</span>

<small className="parameter-list">(<span className="parameter" id="data">data</span>, <span className="parameter" id="time_period">time_period='monthly'</span>, <span className="parameter" id="event_type">event_type=None</span>, <span className="parameter" id="start_date">start_date=None</span>, <span className="parameter" id="end_date">end_date=None</span>, <span className="parameter" id="percentage">percentage=False</span>, <span className="parameter" id="display">display=True</span>)</small>


<div className="content">

Finds the number of users in a given cohort who are active at a given time
period, where time is computed with respect to the beginning of each cohort.
The “active user” is the user who made an action that we are interested in
that time period.
Users are divided into mutually exclusive cohorts, which are then
tracked over time. In our case users are assigned to a cohort based on
when they made their first action that we are interested in.

Returns the retention matrix dataframe, it represents users retained across cohorts:

* index value represents the cohort
* columns represent the number of given date period since the current cohort
* values represent number (or percentage) of unique active users of a given cohort

One can calculate the retention matrix for a given time range, for that
one can specify start_date a/o end_date.
N.B. the users’ activity starts to be traced from the first date the user is seen in the `data`.


#### Parameters

* **`data`** – [`bach.DataFrame`](/modeling/bach/api-reference/DataFrame/bach.DataFrame.mdx) to apply the method on.
* **`time_period`** – can be ‘daily’, ‘weekly’, ‘monthly’ or ‘yearly’.
* **`event_type`** – the event/action that we are interested in.
Must be a valid event_type (either parent or child).
if None we take all the events generated by the user.
* **`start_date`** – start date of the retention matrix, e.g. ‘2022-04-01’
if None take all the data.
* **`end_date`** – end date of the retention matrix, e.g. ‘2022-05-01’
if None take all the data.
* **`percentage`** – if True calculate percentage with respect to the number of a users
in the cohort, otherwise it leaves the absolute values.
* **`display`** – if display==True visualize the retention matrix as a heat map



#### Returns

retention matrix bach DataFrame.




import VimeoPlayer from '@site/src/components/vimeo-player';

<VimeoPlayer id="product-demo-retention-matrix" videoId="723381969" paddingBottom="58.25%" />


</div>


</div>

<div className="method">

### <span className="name">session_duration</span>

<small className="parameter-list">(<span className="parameter" id="data">data</span>, <span className="parameter" id="groupby">groupby=NotSet.token</span>, <span className="parameter" id="exclude_bounces">exclude_bounces=True</span>, <span className="parameter" id="method">method='mean'</span>)</small>


<div className="content">

Calculate the duration of sessions.

With default `method`, it calculates the mean of the session duration over the `groupby`.


#### Parameters

* **`data`** – [`bach.DataFrame`](/modeling/bach/api-reference/DataFrame/bach.DataFrame.mdx) to apply the method on.
* **`groupby`** – sets the column(s) to group by.
  * if not_set it defaults to using [`ModelHub.time_agg`](/modeling/open-model-hub/api-reference/ModelHub/modelhub.ModelHub.time_agg.mdx).
  * if None it aggregates over all data.

* **`exclude_bounces`** – if True only session durations greater than 0 will be considered
* **`method`** – ‘mean’ or ‘sum’



#### Returns

series with results.



</div>


</div>

<div className="method">

### <span className="name">top_product_features</span>

<small className="parameter-list">(<span className="parameter" id="data">data</span>, <span className="parameter" id="location_stack">location_stack=None</span>, <span className="parameter" id="event_type">event_type='InteractiveEvent'</span>)</small>


<div className="content">

Calculate the top used features in the product.


#### Parameters

* **`data`** – [`bach.DataFrame`](/modeling/bach/api-reference/DataFrame/bach.DataFrame.mdx) to apply the method on.
* **`location_stack`** – the location stack
  * can be any slice of a [`modelhub.SeriesLocationStack`](/modeling/open-model-hub/api-reference/SeriesLocationStack/modelhub.SeriesLocationStack.mdx) type column
  * if None - the whole location stack is taken.

* **`event_type`** – event type. Must be a valid event_type (either parent or child).



#### Returns

bach DataFrame with results.



</div>


</div>

<div className="method">

### <span className="name">top_product_features_before_conversion</span>

<small className="parameter-list">(<span className="parameter" id="data">data</span>, <span className="parameter" id="name">name</span>, <span className="parameter" id="location_stack">location_stack=None</span>, <span className="parameter" id="event_type">event_type='InteractiveEvent'</span>)</small>


<div className="content">

Calculates what users did before converting by
combining several models from the model hub.


#### Parameters

* **`data`** – [`bach.DataFrame`](/modeling/bach/api-reference/DataFrame/bach.DataFrame.mdx) to apply the method on.
* **`name`** – label of the conversion event.
* **`location_stack`** – the location stack
  * can be any slice of a [`modelhub.SeriesLocationStack`](/modeling/open-model-hub/api-reference/SeriesLocationStack/modelhub.SeriesLocationStack.mdx) type column
  * if None - the whole location stack is taken.

* **`event_type`** – event type. Must be a valid event_type
(either parent or child).



#### Returns

bach DataFrame with results.



</div>


</div>

<div className="method">

### <span className="name">unique_sessions</span>

<small className="parameter-list">(<span className="parameter" id="data">data</span>, <span className="parameter" id="groupby">groupby=NotSet.token</span>)</small>


<div className="content">

Calculate the unique sessions in the Objectiv `data`.


#### Parameters

* **`data`** – [`bach.DataFrame`](/modeling/bach/api-reference/DataFrame/bach.DataFrame.mdx) to apply the method on.
* **`groupby`** – sets the column(s) to group by.
  * if not_set it defaults to using [`ModelHub.time_agg`](/modeling/open-model-hub/api-reference/ModelHub/modelhub.ModelHub.time_agg.mdx).
  * if None it aggregates over all data.




#### Returns

series with results.



</div>


</div>

<div className="method">

### <span className="name">unique_users</span>

<small className="parameter-list">(<span className="parameter" id="data">data</span>, <span className="parameter" id="groupby">groupby=NotSet.token</span>)</small>


<div className="content">

Calculate the unique users in the Objectiv `data`.


#### Parameters

* **`data`** – [`bach.DataFrame`](/modeling/bach/api-reference/DataFrame/bach.DataFrame.mdx) to apply the method on.
* **`groupby`** – sets the column(s) to group by.
  * if not_set it defaults to using [`ModelHub.time_agg`](/modeling/open-model-hub/api-reference/ModelHub/modelhub.ModelHub.time_agg.mdx).
  * if None it aggregates over all data.




#### Returns

series with results.



</div>


</div>


</div>


</div>


</div>


</div>
